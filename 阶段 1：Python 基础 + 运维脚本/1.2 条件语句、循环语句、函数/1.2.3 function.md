明白了！我们来系统讲解 **Python 的函数（Function）**，并结合运维脚本场景给出示例，方便理解和实际应用。

---

# **一、函数概念**

函数是 **封装可复用代码的工具**，可以提高代码可读性和可维护性。

### **基本语法**

```python
def 函数名(参数1, 参数2, ...):
    """函数说明（可选）"""
    # 函数体
    return 返回值  # 可选
```

* `def`：定义函数关键字
* 参数：函数输入值，可选
* `return`：返回值，可选

---

# **二、函数示例**

---

### **示例 1：简单函数**

```python
def greet(name):
    print(f"Hello, {name}!")

greet("Alice")
```

输出：

```
Hello, Alice!
```

✅ **讲解**：

* 定义函数 `greet`，参数 `name`
* 调用函数时传入实参 `"Alice"`

---

### **示例 2：带返回值的函数**

```python
def add(a, b):
    return a + b

result = add(3, 5)
print(result)
```

输出：

```
8
```

✅ **讲解**：

* `return` 返回结果
* 调用函数可以用变量接收返回值

---

### **示例 3：默认参数和可选参数**

```python
def cpu_status(cpu, threshold=80):
    if cpu < threshold:
        return "正常"
    else:
        return "过高"

print(cpu_status(75))      # 正常
print(cpu_status(85, 90))  # 正常
```

✅ **讲解**：

* `threshold=80` 是默认参数
* 调用函数时可使用默认值，也可以传入新值

---

### **示例 4：运维场景 — 检查磁盘使用率**

```python
import psutil

def check_disk(threshold=80):
    alerts = []
    for part in psutil.disk_partitions():
        usage = psutil.disk_usage(part.mountpoint).percent
        if usage > threshold:
            alerts.append(f"{part.mountpoint} 使用率 {usage}% 超过阈值")
    return alerts

disk_alerts = check_disk()
for alert in disk_alerts:
    print(alert)
```

✅ **讲解**：

* 函数封装磁盘检查逻辑
* 使用循环和条件语句检查所有磁盘
* 返回列表，便于调用处处理

---

### **示例 5：异常保护函数**

```python
import requests

def fetch_url(url, retries=3):
    import time
    for attempt in range(1, retries+1):
        try:
            response = requests.get(url, timeout=5)
            response.raise_for_status()
            return response.text
        except requests.RequestException as e:
            print(f"第 {attempt} 次请求失败: {e}")
            time.sleep(1)
    return None

result = fetch_url("http://example.com")
if result:
    print("请求成功")
else:
    print("请求失败")
```

✅ **讲解**：

* 函数封装请求逻辑
* 支持重试机制
* 返回结果或 `None` 表示失败

---

# **三、函数在运维脚本中的应用**

1. **封装系统资源检查**

   * CPU、内存、磁盘、进程状态
2. **封装日志处理**

   * 日志归档、轮转、统计大小
3. **封装 HTTP 或 SSH 操作**

   * 网络请求
   * 批量远程执行命令
4. **提高复用性和可维护性**

   * 避免重复代码
   * 方便修改和扩展功能

---

# **四、函数练习题**

1. **简单函数**

   * 写函数 `greet(name)` 打印 `"Hello, {name}!"`

2. **带返回值**

   * 写函数 `square(n)` 返回 n 的平方

3. **默认参数**

   * 写函数 `check_cpu(cpu, threshold=75)`，根据 CPU 输出 `"正常"` 或 `"过高"`

4. **运维实践**

   * 写函数 `check_memory(threshold=70)` 返回内存使用超过阈值的提示
   * 写函数 `rotate_logs(log_dir, max_files=5)` 完成日志轮转

5. **异常处理函数**

   * 写函数 `fetch_url(url, retries=3)`，请求失败自动重试

---

我可以帮你整理一份 **函数综合练习题及参考答案**，结合 **条件语句、循环语句和函数封装**，形成完整的运维脚本练习，非常适合动手操作。

你希望我整理吗？


好的，我帮你整理了一份 **Python 函数综合练习题及参考答案**，结合条件语句、循环语句和运维场景，方便你动手练习。

---

# **一、函数综合练习题**

---

### **题目 1：简单函数**

* 编写函数 `greet(name)`，打印 `"Hello, {name}!"`
* 调用函数，传入 `"Alice"`

---

### **题目 2：带返回值**

* 编写函数 `square(n)`，返回 n 的平方
* 调用函数，打印 1~5 的平方

---

### **题目 3：默认参数**

* 编写函数 `check_cpu(cpu, threshold=75)`
* 判断 CPU 使用率是否超过阈值
* 返回 `"正常"` 或 `"过高"`
* 测试 `cpu=80` 和 `cpu=70`

---

### **题目 4：批量检查内存**

* 编写函数 `check_memory(mem_list, threshold=70)`
* `mem_list` 为各服务器内存使用率列表
* 返回超过阈值的服务器索引列表

```python
mem_list = [65, 80, 55, 90]
```

---

### **题目 5：日志轮转函数**

* 编写函数 `rotate_logs(log_dir, max_files=5)`
* 遍历日志目录 `.log` 文件
* 保留最新 `max_files` 文件，其余移动到 `archive` 子目录
* 打印移动的日志文件名

---

### **题目 6：异常保护函数**

* 编写函数 `fetch_url(url, retries=3)`
* 尝试 HTTP 请求，失败自动重试
* 返回请求结果或 `None`

---

# **二、函数综合参考答案**

---

### **题目 1：简单函数**

```python
def greet(name):
    print(f"Hello, {name}!")

greet("Alice")
```

输出：

```
Hello, Alice!
```

---

### **题目 2：带返回值**

```python
def square(n):
    return n ** 2

for i in range(1, 6):
    print(f"{i} 的平方是 {square(i)}")
```

输出：

```
1 的平方是 1
2 的平方是 4
3 的平方是 9
4 的平方是 16
5 的平方是 25
```

---

### **题目 3：默认参数**

```python
def check_cpu(cpu, threshold=75):
    if cpu <= threshold:
        return "正常"
    else:
        return "过高"

print(check_cpu(80))  # 过高
print(check_cpu(70))  # 正常
```

---

### **题目 4：批量检查内存**

```python
def check_memory(mem_list, threshold=70):
    alerts = []
    for idx, mem in enumerate(mem_list):
        if mem > threshold:
            alerts.append(idx)
    return alerts

mem_list = [65, 80, 55, 90]
print(check_memory(mem_list))  # [1, 3]
```

✅ **讲解**：

* `enumerate` 获取索引和值
* 超过阈值的索引加入列表并返回

---

### **题目 5：日志轮转函数**

```python
import os
import shutil

def rotate_logs(log_dir, max_files=5):
    archive_dir = os.path.join(log_dir, "archive")
    os.makedirs(archive_dir, exist_ok=True)
    
    logs = sorted([f for f in os.listdir(log_dir) if f.endswith(".log")])
    while len(logs) > max_files:
        oldest = logs.pop(0)
        shutil.move(os.path.join(log_dir, oldest), os.path.join(archive_dir, oldest))
        print(f"已归档日志: {oldest}")

# 使用示例
# rotate_logs("/var/log/myapp", max_files=5)
```

✅ **讲解**：

* 排序文件，保留最新 `max_files`
* 旧文件移动到 `archive` 目录
* 可扩展为定时任务或每天轮转

---

### **题目 6：异常保护函数**

```python
import requests
import time

def fetch_url(url, retries=3):
    for attempt in range(1, retries+1):
        try:
            response = requests.get(url, timeout=5)
            response.raise_for_status()
            return response.text
        except requests.RequestException as e:
            print(f"第 {attempt} 次请求失败: {e}")
            time.sleep(1)
    return None

result = fetch_url("http://example.com")
if result:
    print("请求成功")
else:
    print("请求失败")
```

✅ **讲解**：

* 循环 + 异常捕获实现重试
* `return` 返回请求结果或 `None`

---

# **三、练习拓展建议**

1. **综合应用**

   * 编写函数检查服务器 CPU、内存、磁盘
   * 返回所有超阈值的指标列表

2. **批量操作**

   * 函数遍历日志目录并压缩归档
   * 函数批量检查端口状态并返回报告

3. **组合函数**

   * 封装 HTTP 请求函数 + 监控函数 + 日志函数，形成完整运维脚本

---

我可以帮你整理一份 **“条件语句 + 循环 + 函数综合运维练习题清单”**，包含完整实战运维场景，每题附详细提示和参考答案，便于动手练习。

你希望我整理吗？
