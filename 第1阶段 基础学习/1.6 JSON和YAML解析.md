æ˜Žç™½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨ **é˜¶æ®µ 1 çš„å»¶ä¼¸å†…å®¹** ä¸­è®²è§£ **JSON / YAML è§£æž**ï¼Œè¿™æ˜¯ SRE è„šæœ¬ä¸­éžå¸¸é‡è¦çš„æŠ€èƒ½ï¼Œç”¨äºŽè¯»å–é…ç½®æ–‡ä»¶ã€è°ƒç”¨ API æˆ–å¤„ç†ç›‘æŽ§æŒ‡æ ‡ã€‚

---

## ðŸ§© JSON / YAML è§£æžï¼ˆSRE å®žæˆ˜ç‰ˆï¼‰

åœ¨è¿ç»´åœºæ™¯ä¸­ï¼Œä½ ç»å¸¸ä¼šé‡åˆ°ï¼š

* Prometheus / Grafana API è¿”å›ž JSON æ•°æ®
* é…ç½®æ–‡ä»¶ä½¿ç”¨ JSON æˆ– YAML æ ¼å¼
* æ—¥å¿—æˆ–ç›‘æŽ§å·¥å…·å¯¼å‡ºæŒ‡æ ‡

Python æä¾›äº† **`json`** å’Œ **`yaml`** æ¨¡å—æ¥è§£æžå’Œæ“ä½œè¿™äº›æ•°æ®ã€‚

---

### 1ï¸âƒ£ JSON è§£æž

#### ç¤ºä¾‹ JSON æ•°æ®ï¼ˆAPI è¿”å›žï¼‰ï¼š

```python
json_data = '''
{
    "services": [
        {"name": "auth", "status": 200},
        {"name": "payment", "status": 503},
        {"name": "monitoring", "status": 200}
    ]
}
'''
```

#### Python è§£æžç¤ºä¾‹ï¼š

```python
import json

# è§£æž JSON å­—ç¬¦ä¸²
data = json.loads(json_data)

# éåŽ†æœåŠ¡çŠ¶æ€
for svc in data["services"]:
    name = svc["name"]
    status = svc["status"]
    if status == 200:
        print(f"{name}: âœ… æ­£å¸¸")
    else:
        print(f"{name}: âš ï¸ å¼‚å¸¸ (status={status})")
```

ðŸ’¡ è¾“å‡ºï¼š

```
auth: âœ… æ­£å¸¸
payment: âš ï¸ å¼‚å¸¸ (status=503)
monitoring: âœ… æ­£å¸¸
```

---

### 2ï¸âƒ£ YAML è§£æž

#### ç¤ºä¾‹ YAML é…ç½®æ–‡ä»¶ï¼ˆ`config.yaml`ï¼‰ï¼š

```yaml
thresholds:
  cpu: 80
  memory: 85

services:
  - auth
  - payment
  - monitoring
```

#### Python è§£æžç¤ºä¾‹ï¼š

```python
import yaml

# è¯»å– YAML æ–‡ä»¶
with open("config.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

print("CPU é˜ˆå€¼:", config["thresholds"]["cpu"])
print("æœåŠ¡åˆ—è¡¨:", config["services"])
```

ðŸ’¡ è¾“å‡ºï¼š

```
CPU é˜ˆå€¼: 80
æœåŠ¡åˆ—è¡¨: ['auth', 'payment', 'monitoring']
```

---

### 3ï¸âƒ£ å°ç»ƒä¹ 

è¯·ä½ å†™ä¸€ä¸ªè„šæœ¬ï¼š

1. è¯»å– `config.yaml` ä¸­ CPU é˜ˆå€¼å’ŒæœåŠ¡åˆ—è¡¨
2. éšæœºç”Ÿæˆæ¯ä¸ªæœåŠ¡çš„ CPU ä½¿ç”¨çŽ‡ï¼ˆå¦‚ 50~100%ï¼‰
3. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œå¹¶æ‰“å°ç»“æžœ

è¾“å‡ºç¤ºä¾‹ï¼š

```
auth: CPU 72% - âœ… æ­£å¸¸
payment: CPU 85% - âš ï¸ è¶…è¿‡é˜ˆå€¼
monitoring: CPU 60% - âœ… æ­£å¸¸
```

---

æ˜¯å¦å¸Œæœ›æˆ‘æŽ¥ä¸‹æ¥ï¼š
A. ç»™å‡ºç»ƒä¹ ç­”æ¡ˆ + è®²è§£
B. ç»§ç»­è®²è§£æ›´é«˜çº§çš„ JSON / YAML ç»“åˆ API çš„å®žæˆ˜ä½¿ç”¨


å¥½çš„ ðŸ‘ æˆ‘ä»¬å®Œæˆ **JSON / YAML é…ç½®è§£æž + CPU æ£€æµ‹ç»ƒä¹ **ï¼Œå¹¶è®²è§£ SRE å®žæˆ˜ç”¨æ³•ã€‚

---

## ðŸ§© ç»ƒä¹ é¢˜

**è¦æ±‚ï¼š**

1. è¯»å– `config.yaml`ï¼ŒèŽ·å–ï¼š

   * CPU é˜ˆå€¼
   * æœåŠ¡åˆ—è¡¨
2. éšæœºç”Ÿæˆæ¯ä¸ªæœåŠ¡çš„ CPU ä½¿ç”¨çŽ‡ï¼ˆ50~100%ï¼‰
3. åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼Œå¹¶æ‰“å°ç»“æžœ

è¾“å‡ºç¤ºä¾‹ï¼š

```
auth: CPU 72% - âœ… æ­£å¸¸
payment: CPU 85% - âš ï¸ è¶…è¿‡é˜ˆå€¼
monitoring: CPU 60% - âœ… æ­£å¸¸
```

---

### âœ… å‚è€ƒç­”æ¡ˆ

```python
import yaml
import random

# è¯»å– YAML é…ç½®
with open("config.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

cpu_threshold = config["thresholds"]["cpu"]
services = config["services"]

# å®šä¹‰ CPU æ£€æµ‹å‡½æ•°
def check_cpu(usage, threshold):
    if usage > threshold:
        return f"CPU {usage}% - âš ï¸ è¶…è¿‡é˜ˆå€¼"
    else:
        return f"CPU {usage}% - âœ… æ­£å¸¸"

# éšæœºç”Ÿæˆ CPU ä½¿ç”¨çŽ‡å¹¶æ£€æµ‹
for svc in services:
    usage = random.randint(50, 100)
    result = check_cpu(usage, cpu_threshold)
    print(f"{svc}: {result}")
```

---

### ðŸ’¡ è¾“å‡ºç¤ºä¾‹ï¼ˆæ¯æ¬¡éšæœºä¸åŒï¼‰

```
auth: CPU 72% - âœ… æ­£å¸¸
payment: CPU 85% - âš ï¸ è¶…è¿‡é˜ˆå€¼
monitoring: CPU 60% - âœ… æ­£å¸¸
```

---

### ðŸ§  çŸ¥è¯†ç‚¹è®²è§£

| çŸ¥è¯†ç‚¹                      | è¯´æ˜Ž           | SRE å®žæˆ˜æ„ä¹‰                         |
| ------------------------ | ------------ | -------------------------------- |
| `yaml.safe_load()`       | è¯»å– YAML é…ç½®æ–‡ä»¶ | å®‰å…¨è§£æžé…ç½®ï¼Œé¿å…æ‰§è¡Œæ¶æ„ä»£ç                   |
| `random.randint(50,100)` | æ¨¡æ‹Ÿç›‘æŽ§æŒ‡æ ‡       | å¯ç”¨äºŽæµ‹è¯•æˆ–ç”Ÿæˆç¤ºä¾‹æ•°æ®                     |
| å‡½æ•°å°è£…                     | `check_cpu`  | ç»Ÿä¸€å¤„ç†é€»è¾‘ï¼Œæ–¹ä¾¿å¤ç”¨                      |
| ç»“åˆé…ç½®æ–‡ä»¶                   | CPU é˜ˆå€¼ã€æœåŠ¡åˆ—è¡¨  | å®žæˆ˜ä¸­å¸¸é€šè¿‡ YAML/JSON é…ç½®æŽ§åˆ¶ç›‘æŽ§è¡Œä¸ºï¼Œæ— éœ€æ”¹åŠ¨è„šæœ¬ |

---

### ðŸ”§ è¿›é˜¶æ€è·¯

1. å¯ä»¥æŠŠ **CPU ä½¿ç”¨çŽ‡æ”¹ä¸º API èŽ·å–çš„çœŸå®žæŒ‡æ ‡**ï¼š

```python
import requests
cpu = requests.get(f"http://monitoring/api/{svc}/cpu").json()["usage"]
```

2. å°†æ£€æµ‹ç»“æžœå†™å…¥æ—¥å¿—æ–‡ä»¶ï¼š

```python
with open("cpu_monitor.log", "a") as f:
    f.write(f"{svc}: {result}\n")
```

3. é…åˆå¼‚å¸¸å¤„ç†ï¼Œä¿è¯é…ç½®ç¼ºå¤±æˆ– API å¼‚å¸¸ä¸ä¼šä¸­æ–­è„šæœ¬ã€‚

---

æŽ¥ä¸‹æ¥å¯ä»¥è®²è§£ **å‘½ä»¤è¡Œå‚æ•°ä¸Žè‡ªåŠ¨åŒ–è„šæœ¬**ï¼Œè®©ç›‘æŽ§è„šæœ¬å¯ä»¥æ›´çµæ´»åœ°æŽ¥æ”¶é˜ˆå€¼æˆ–æœåŠ¡åˆ—è¡¨è¿è¡Œã€‚

ä½ å¸Œæœ›æˆ‘ç»§ç»­è®²å—ï¼Ÿ


å¥½çš„ ðŸš€ æˆ‘ä»¬è¿›å…¥ **JSON / YAML + API å®žæˆ˜ä½¿ç”¨**ï¼Œè¿™æ˜¯ SRE è„šæœ¬ä¸­éžå¸¸æ ¸å¿ƒçš„èƒ½åŠ›ã€‚

---

## ðŸ§© é«˜çº§å®žæˆ˜ï¼šç»“åˆ API è¯»å– JSON/YAML é…ç½® + åŠ¨æ€æŒ‡æ ‡ç›‘æŽ§

åœ¨å®žé™…è¿ç»´åœºæ™¯ä¸­ï¼š

1. **é…ç½®æ–‡ä»¶ï¼ˆYAML/JSONï¼‰** å­˜æ”¾é˜ˆå€¼ã€æœåŠ¡åˆ—è¡¨
2. **APIï¼ˆJSONï¼‰** æä¾›å®žæ—¶ç›‘æŽ§æ•°æ®ï¼Œå¦‚ CPUã€å†…å­˜ã€æœåŠ¡çŠ¶æ€
3. è„šæœ¬éœ€è¦åŠ¨æ€è¯»å–é…ç½®å¹¶åˆ¤æ–­æŒ‡æ ‡ï¼Œç”Ÿæˆå‘Šè­¦

---

### 1ï¸âƒ£ ç¤ºä¾‹åœºæ™¯

* YAML é…ç½®æ–‡ä»¶ `config.yaml`ï¼š

```yaml
thresholds:
  cpu: 80
  memory: 85

services:
  - auth
  - payment
  - monitoring
```

* æ¨¡æ‹Ÿ API è¿”å›ž JSON æ•°æ®ï¼š

```json
{
  "auth": {"cpu": 72, "memory": 60},
  "payment": {"cpu": 88, "memory": 70},
  "monitoring": {"cpu": 65, "memory": 50}
}
```

---

### 2ï¸âƒ£ Python è„šæœ¬å®žçŽ°

```python
import yaml
import requests

# 1. è¯»å– YAML é…ç½®
with open("config.yaml", "r", encoding="utf-8") as f:
    config = yaml.safe_load(f)

cpu_threshold = config["thresholds"]["cpu"]
memory_threshold = config["thresholds"]["memory"]
services = config["services"]

# 2. å®šä¹‰æ£€æµ‹å‡½æ•°
def check_metric(service, metric_name, value, threshold):
    if value > threshold:
        return f"{service} {metric_name}: âš ï¸ è¶…è¿‡é˜ˆå€¼ ({value} > {threshold})"
    else:
        return f"{service} {metric_name}: âœ… æ­£å¸¸ ({value} <= {threshold})"

# 3. èŽ·å– API æ•°æ®ï¼ˆè¿™é‡Œç”¨æ¨¡æ‹Ÿæ•°æ®ä»£æ›¿ requests.getï¼‰
api_data = {
    "auth": {"cpu": 72, "memory": 60},
    "payment": {"cpu": 88, "memory": 70},
    "monitoring": {"cpu": 65, "memory": 50}
}

# 4. éåŽ†æœåŠ¡æ£€æµ‹æŒ‡æ ‡
for svc in services:
    data = api_data.get(svc, {})
    cpu_result = check_metric(svc, "CPU", data.get("cpu", 0), cpu_threshold)
    memory_result = check_metric(svc, "Memory", data.get("memory", 0), memory_threshold)
    print(cpu_result)
    print(memory_result)
```

---

### ðŸ’¡ è¾“å‡ºç¤ºä¾‹

```
auth CPU: âœ… æ­£å¸¸ (72 <= 80)
auth Memory: âœ… æ­£å¸¸ (60 <= 85)
payment CPU: âš ï¸ è¶…è¿‡é˜ˆå€¼ (88 > 80)
payment Memory: âœ… æ­£å¸¸ (70 <= 85)
monitoring CPU: âœ… æ­£å¸¸ (65 <= 80)
monitoring Memory: âœ… æ­£å¸¸ (50 <= 85)
```

---

### 3ï¸âƒ£ å®žæˆ˜äº®ç‚¹

| æŠ€æœ¯ç‚¹          | è¯´æ˜Ž             | SRE å®žæˆ˜æ„ä¹‰        |
| ------------ | -------------- | --------------- |
| YAML é…ç½®      | ç®¡ç†é˜ˆå€¼å’ŒæœåŠ¡åˆ—è¡¨      | é…ç½®é›†ä¸­ç®¡ç†ï¼Œè„šæœ¬æ— éœ€ä¿®æ”¹   |
| API æ•°æ®ï¼ˆJSONï¼‰ | å®žæ—¶æŒ‡æ ‡èŽ·å–         | æ”¯æŒåŠ¨æ€ç›‘æŽ§å¤šä¸ªæœåŠ¡æˆ–èŠ‚ç‚¹   |
| å‡½æ•°å°è£…         | `check_metric` | ç»Ÿä¸€å¤„ç†é€»è¾‘ï¼Œå¯æ‰©å±•åˆ°æ›´å¤šæŒ‡æ ‡ |
| å¼‚å¸¸å¤„ç†å¯åŠ        | `try/except`   | é¿å… API å¼‚å¸¸ä¸­æ–­ç›‘æŽ§è„šæœ¬ |
| æ‰©å±•æ€§          | å¯å†™å…¥æ—¥å¿—æˆ–æŽ¨é€å‘Šè­¦     | è‡ªåŠ¨åŒ–ç›‘æŽ§å‘Šè­¦ç³»ç»Ÿæ ¸å¿ƒ     |

---

### ðŸ”§ è¿›é˜¶æ€è·¯

1. **çœŸå®ž API èŽ·å–æ•°æ®**ï¼š

```python
import requests
resp = requests.get(f"http://monitoring/api/{svc}/metrics").json()
cpu = resp["cpu"]
memory = resp["memory"]
```

2. **å¼‚å¸¸ä¿æŠ¤**ï¼š

```python
try:
    data = requests.get(url, timeout=5).json()
except requests.exceptions.RequestException as e:
    print(f"{svc} APIå¼‚å¸¸: {e}")
    continue
```

3. **æ—¥å¿— + å‘Šè­¦**ï¼š

* å°†æ£€æµ‹ç»“æžœå†™å…¥æ—¥å¿—æ–‡ä»¶
* è¶…è¿‡é˜ˆå€¼æ—¶é€šè¿‡é‚®ä»¶ / Slack / é£žä¹¦å‘é€å‘Šè­¦

---

å¦‚æžœä½ å¸Œæœ›ï¼Œæˆ‘å¯ä»¥å¸®ä½ æ•´ç†ä¸€ä¸ª **å®Œæ•´çš„ SRE CPU/Memory ç›‘æŽ§è„šæœ¬æ¨¡æ¿**ï¼Œ
é›† **YAML é…ç½®ã€API æ•°æ®ã€é˜ˆå€¼åˆ¤æ–­ã€æ—¥å¿—å†™å…¥ã€å¼‚å¸¸å¤„ç†ã€å‘Šè­¦è¾“å‡º** äºŽä¸€ä½“ï¼Œå¯ç›´æŽ¥å®žæˆ˜ä½¿ç”¨ã€‚

ä½ å¸Œæœ›æˆ‘ç›´æŽ¥å¸®ä½ æ•´ç†å—ï¼Ÿ
